// این تابع باید قبل از on_confirmPushButton_clicked باشد
void createPayment(const QString &carId)
{
    // 1. پیدا کردن قیمت ماشین از فایل cars.txt
    QString carPath = QCoreApplication::applicationDirPath() + "/cars.txt";
    QFile carFile(carPath);

    int price = 0;

    if (carFile.open(QIODevice::ReadOnly | QIODevice::Text)) {
        QTextStream in(&carFile);
        while (!in.atEnd()) {
            QString line = in.readLine();
            QStringList parts = line.split(",");
            // چک کردن اینکه آیا این خط مربوط به ماشین انتخاب شده است یا خیر
            if (parts.size() >= 4 && parts[0] == carId) {
                price = parts[3].toInt(); // قیمت در ستون چهارم است (اینکس 3)
                break;
            }
        }
        carFile.close();
    } else {
        QMessageBox::warning(nullptr, "Error", "Cannot open cars.txt to read price!");
        return; // اگر فایل ماشین باز نشود، ادامه نمی‌دهد
    }

    // اگر قیمت پیدا نشد، یک قیمت پیش‌فرض یا خطا در نظر بگیرید
    if (price == 0) {
        QMessageBox::warning(nullptr, "Error", "Car price not found for ID: " + carId);
        // اینجا return نمی‌کنیم تا حداقل فایل ساخته شود، اما قیمت 0 ثبت می‌شود
    }

    // 2. ذخیره در فایل payments.txt
    QString payPath = QCoreApplication::applicationDirPath() + "/payments.txt";
    QFile payFile(payPath);

    // بررسی وجود فایل و باز کردن آن
    if (!payFile.open(QIODevice::Append | QIODevice::Text)) {
        QMessageBox::warning(nullptr, "Error", "Cannot open/create payments.txt!");
        return;
    }

    QTextStream out(&payFile);
    
    // استفاده از شناسه کاربر لاگین شده (session::userId)
    // فرمت: UserID,CarID,Price,Status
    out << session::userId << "," << carId << "," << price << ",Unpaid\n";
    
    // فلاش کردن برای اطمینان از نوشته شدن اطلاعات
    payFile.flush();
    payFile.close();
}
